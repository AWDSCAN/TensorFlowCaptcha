# éªŒè¯ç è¯†åˆ«è®­ç»ƒçªç ´æ–¹æ¡ˆ 2026-02-02

## ğŸ” é—®é¢˜è¯Šæ–­

### å½“å‰è®­ç»ƒæ•ˆæœ
- **å®Œæ•´åŒ¹é…å‡†ç¡®ç‡**: 63.81% (ç›®æ ‡: 82%)
- **äºŒè¿›åˆ¶å‡†ç¡®ç‡**: 99.75% (å¾ˆé«˜)
- **æ•°å­¦é¢˜è¯†åˆ«**: 1.75% (æå·®)
- **è®­ç»ƒæ­¥æ•°**: 200000æ­¥åæå‰ç»ˆæ­¢

### æ ¸å¿ƒé—®é¢˜
1. âœ… **æ•°æ®å¤„ç†æ­£å¸¸**: `parse_filename()`å‡½æ•°å·²æ­£ç¡®æ”¯æŒhexè§£ç æ•°å­¦é¢˜
2. âš ï¸ **æ¨¡å‹æ¶æ„é—®é¢˜**: äºŒè¿›åˆ¶å‡†ç¡®ç‡é«˜ä½†å®Œæ•´åŒ¹é…ä½ â†’ **åºåˆ—å»ºæ¨¡èƒ½åŠ›ä¸è¶³**
3. âš ï¸ **æ•°å­¦é¢˜å¹²æ‰°å¤ªå¼º**: æ•°å­¦ç¬¦å·(+-*=?)è¯†åˆ«å›°éš¾
4. âš ï¸ **è®­ç»ƒç­–ç•¥ä¸å¤Ÿæ¿€è¿›**: å­¦ä¹ ç‡è¡°å‡å¤ªå¿«ï¼Œæå‰åœæ­¢

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: å¢å¼ºå‹CNNæ¨¡å‹ + æ³¨æ„åŠ›æœºåˆ¶
**ç›®æ ‡**: æå‡åºåˆ—å»ºæ¨¡èƒ½åŠ›ï¼Œä»64%çªç ´åˆ°82%+

#### 1.1 æ·»åŠ æ³¨æ„åŠ›å±‚
```python
# åœ¨å…¨è¿æ¥å±‚å‰æ·»åŠ Self-Attention
class SelfAttention(layers.Layer):
    def __init__(self, units):
        super().__init__()
        self.W = layers.Dense(units)
        self.U = layers.Dense(units)
        self.V = layers.Dense(1)
    
    def call(self, features):
        # features: [batch, features]
        score = tf.nn.tanh(self.W(features))
        attention_weights = tf.nn.softmax(self.V(score), axis=1)
        context = attention_weights * features
        return context
```

#### 1.2 æ”¹è¿›è¾“å‡ºå±‚ç»“æ„
```python
# ä»å•ä¸€è¾“å‡º â†’ åˆ†ç»„è¾“å‡ºï¼ˆ8ä¸ªå­—ç¬¦åˆ†åˆ«é¢„æµ‹ï¼‰
outputs = []
for i in range(8):
    out = layers.Dense(CHAR_SET_LEN, activation='softmax', 
                       name=f'char_{i}')(x)
    outputs.append(out)
```

### æ–¹æ¡ˆ2: ä¼˜åŒ–è®­ç»ƒç­–ç•¥

#### 2.1 é™ä½å­¦ä¹ ç‡è¡°å‡é€Ÿåº¦
```python
# å½“å‰: æ¯10000æ­¥ Ã— 0.98 â†’ å¤ªå¿«
# æ”¹è¿›: æ¯15000æ­¥ Ã— 0.99 â†’ æ›´å¹³ç¼“
lr_schedule = keras.optimizers.schedules.ExponentialDecay(
    initial_learning_rate=0.001,      # ä»0.0008æå‡åˆ°0.001
    decay_steps=15000,                # ä»10000å»¶é•¿åˆ°15000
    decay_rate=0.99,                  # ä»0.98è°ƒæ•´åˆ°0.99
    staircase=True
)
```

#### 2.2 å»¶é•¿è®­ç»ƒæ—¶é—´
```python
# å½“å‰: max_steps=50000, end_acc=0.82
# æ”¹è¿›: max_steps=300000, end_acc=0.82
# ç†ç”±: ç›®å‰200kæ­¥æ‰åˆ°64%ï¼Œéœ€è¦æ›´å¤šè®­ç»ƒ
```

#### 2.3 æ·»åŠ Focal Loss (å·²æœ‰ä½†æœªå¯ç”¨)
```python
# å¯ç”¨Focal Losså¤„ç†éš¾æ ·æœ¬
compile_model(
    model,
    use_focal_loss=True,    # æ”¹ä¸ºTrue
    focal_gamma=2.0,        # ä»1.5æå‡åˆ°2.0
    pos_weight=3.0
)
```

### æ–¹æ¡ˆ3: æ•°æ®å¢å¼ºä¼˜åŒ–

#### 3.1 åŠ å¼ºæ•°å­¦é¢˜æ•°æ®å¢å¼º
```python
def augment_for_math(image):
    """ä¸“é—¨é’ˆå¯¹æ•°å­¦é¢˜çš„å¢å¼º"""
    # æ›´å¼ºçš„å¯¹æ¯”åº¦å¢å¼ºï¼ˆçªå‡ºç¬¦å·ï¼‰
    image = random_contrast(image, lower=0.8, upper=1.3)
    # è½»å¾®æ¨¡ç³Šåé”åŒ–ï¼ˆæ¶ˆé™¤ç»†å°å¹²æ‰°ï¼‰
    image = tf.image.adjust_sharpness(image, 2.0)
    return image
```

#### 3.2 åˆ†ç±»å‹è®­ç»ƒç­–ç•¥
```python
# æ£€æµ‹æ–‡ä»¶åä¸­æ˜¯å¦å«æœ‰æ•°å­¦ç¬¦å·
def is_math_captcha(filename):
    text = parse_filename(filename)
    return any(c in text for c in '+-*=?')

# å¯¹æ•°å­¦é¢˜åº”ç”¨ä¸åŒçš„å¢å¼ºç­–ç•¥
```

### æ–¹æ¡ˆ4: æŸå¤±å‡½æ•°æ”¹è¿›

#### 4.1 åºåˆ—æŸå¤± (Sequence Loss)
```python
def sequence_aware_loss(y_true, y_pred):
    """è€ƒè™‘å­—ç¬¦åºåˆ—å…³ç³»çš„æŸå¤±"""
    # åŸºç¡€BCEæŸå¤±
    bce = keras.losses.binary_crossentropy(y_true, y_pred)
    
    # åºåˆ—è¿è´¯æ€§æŸå¤±ï¼ˆç›¸é‚»å­—ç¬¦çš„ç›¸å…³æ€§ï¼‰
    # é¼“åŠ±æ¨¡å‹å­¦ä¹ å­—ç¬¦ä¹‹é—´çš„å…³ç³»
    y_pred_reshaped = tf.reshape(y_pred, [-1, MAX_CAPTCHA, CHAR_SET_LEN])
    
    # è®¡ç®—ç›¸é‚»ä½ç½®é¢„æµ‹çš„å¹³æ»‘åº¦
    diff = y_pred_reshaped[:, 1:, :] - y_pred_reshaped[:, :-1, :]
    smoothness = tf.reduce_mean(tf.abs(diff))
    
    # ç»„åˆæŸå¤±
    return bce + 0.1 * smoothness
```

#### 4.2 å­—ç¬¦ä½ç½®åŠ æƒ
```python
# å‰3ä¸ªå­—ç¬¦é€šå¸¸æ›´é‡è¦ï¼ˆæ•°å­¦é¢˜çš„æ•°å­—éƒ¨åˆ†ï¼‰
position_weights = [1.5, 1.5, 1.5, 1.0, 1.0, 1.0, 0.8, 0.8]
```

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ1: å¿«é€Ÿæ”¹è¿› (1å°æ—¶)
1. âœ… å¯ç”¨Focal Loss (`use_focal_loss=True`)
2. âœ… è°ƒæ•´å­¦ä¹ ç‡ (åˆå§‹0.001, decayæ›´æ…¢)
3. âœ… å»¶é•¿è®­ç»ƒ (max_steps=300000)
4. âœ… é™ä½å‡†ç¡®ç‡è¦æ±‚ (å…ˆè¾¾åˆ°70%å†é€æ­¥æå‡)

### é˜¶æ®µ2: æ¨¡å‹å‡çº§ (2-3å°æ—¶)
1. ğŸ”„ å®ç°åˆ†ç»„è¾“å‡ºå±‚ (8ä¸ªç‹¬ç«‹softmax)
2. ğŸ”„ æ·»åŠ Self-Attentionæœºåˆ¶
3. ğŸ”„ å®ç°åºåˆ—æ„ŸçŸ¥æŸå¤±å‡½æ•°

### é˜¶æ®µ3: æ•°æ®ç­–ç•¥ (1-2å°æ—¶)
1. ğŸ”„ åˆ†ææ•°å­¦é¢˜vsæ™®é€šé¢˜çš„è¯†åˆ«å·®å¼‚
2. ğŸ”„ é’ˆå¯¹æ€§å¢å¼ºæ•°å­¦é¢˜æ•°æ®
3. ğŸ”„ è€ƒè™‘ç”Ÿæˆæ›´å¤šæ•°å­¦é¢˜æ ·æœ¬

## ğŸš€ é¢„æœŸæ•ˆæœ

### ä¿å®ˆä¼°è®¡
- **å®Œæ•´åŒ¹é…**: 63% â†’ **75%** (é€šè¿‡è®­ç»ƒç­–ç•¥ä¼˜åŒ–)
- **æ•°å­¦é¢˜è¯†åˆ«**: 1.75% â†’ **15%** (é€šè¿‡Focal Loss)

### ä¹è§‚ä¼°è®¡
- **å®Œæ•´åŒ¹é…**: 63% â†’ **82%+** (é€šè¿‡æ¨¡å‹æ¶æ„æ”¹è¿›)
- **æ•°å­¦é¢˜è¯†åˆ«**: 1.75% â†’ **40%+** (é€šè¿‡åˆ†ç±»å‹è®­ç»ƒ)

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### ä¸ºä»€ä¹ˆäºŒè¿›åˆ¶å‡†ç¡®ç‡é«˜ä½†å®Œæ•´åŒ¹é…ä½ï¼Ÿ
```
äºŒè¿›åˆ¶å‡†ç¡®ç‡ 99.75% = å•ä¸ªä½ç½®çš„å­—ç¬¦é¢„æµ‹å‡†ç¡®ç‡
å®Œæ•´åŒ¹é…ç‡ 63.81% = æ•´ä¸ªåºåˆ—å®Œå…¨æ­£ç¡®çš„æ¦‚ç‡

å‡è®¾æ¯ä¸ªä½ç½®ç‹¬ç«‹é¢„æµ‹ï¼Œå‡†ç¡®ç‡ä¸ºp:
- 8ä¸ªå­—ç¬¦å…¨å¯¹çš„æ¦‚ç‡ = p^8
- p=0.95 â†’ p^8=0.66 âœ“ (æ¥è¿‘å®é™…)
- p=0.998 â†’ p^8=0.98 âœ— (ä¸ç¬¦åˆ)

ç»“è®º: äºŒè¿›åˆ¶å‡†ç¡®ç‡æ˜¯"æŒ‰ä½"è®¡ç®—çš„ï¼Œå®é™…å•å­—ç¬¦å‡†ç¡®ç‡çº¦95%
```

### ä¸ºä»€ä¹ˆæ•°å­¦é¢˜ç‰¹åˆ«éš¾ï¼Ÿ
1. **å­—ç¬¦é›†æ‰©å±•**: æ–°å¢5ä¸ªç¬¦å·(+-*=?) è®­ç»ƒæ•°æ®ä¸è¶³
2. **åºåˆ—å¤æ‚**: "19+3=?" 6ä¸ªå­—ç¬¦ï¼Œä¸”å«æ•°å­—+ç¬¦å·æ··åˆ
3. **å¹²æ‰°æ›´å¼º**: è™½ç„¶ä»£ç æ³¨é‡Š"æ•°å­¦é¢˜ä¸æ·»åŠ å¹²æ‰°"ï¼Œä½†base noiseä»å­˜åœ¨

## ğŸ“Š å¯¹æ¯”å®éªŒå»ºè®®

å»ºè®®è¿›è¡ŒA/Bæµ‹è¯•:
- **Aç»„**: å½“å‰é…ç½® + å¿«é€Ÿæ”¹è¿› (é˜¶æ®µ1)
- **Bç»„**: å®Œæ•´æ¨¡å‹å‡çº§ (é˜¶æ®µ2+3)

å¯¹æ¯”æŒ‡æ ‡:
- è®­ç»ƒæ—¶é—´
- æœ€ç»ˆå‡†ç¡®ç‡
- æ•°å­¦é¢˜ä¸“é¡¹å‡†ç¡®ç‡

---

**åˆ›å»ºæ—¶é—´**: 2026-02-02
**çŠ¶æ€**: å¾…å®æ–½
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
